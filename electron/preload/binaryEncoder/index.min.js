!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Puz={})}(this,(function(t){"use strict";var e=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o=!1;function s(){o=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)r[e]=t[e],n[t.charCodeAt(e)]=e;n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63}function u(t,e,n){for(var i,o,s=[],u=e;u<n;u+=3)i=(t[u]<<16)+(t[u+1]<<8)+t[u+2],s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}function a(t){var e;o||s();for(var n=t.length,i=n%3,a="",l=[],c=16383,f=0,h=n-i;f<h;f+=c)l.push(u(t,f,f+c>h?h:f+c));return 1===i?(e=t[n-1],a+=r[e>>2],a+=r[e<<4&63],a+="=="):2===i&&(e=(t[n-2]<<8)+t[n-1],a+=r[e>>10],a+=r[e>>4&63],a+=r[e<<2&63],a+="="),l.push(a),l.join("")}function l(t,e,r,n,i){var o,s,u=8*i-n-1,a=(1<<u)-1,l=a>>1,c=-7,f=r?i-1:0,h=r?-1:1,d=t[e+f];for(f+=h,o=d&(1<<-c)-1,d>>=-c,c+=u;c>0;o=256*o+t[e+f],f+=h,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+t[e+f],f+=h,c-=8);if(0===o)o=1-l;else{if(o===a)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=l}return(d?-1:1)*s*Math.pow(2,o-n)}function c(t,e,r,n,i,o){var s,u,a,l=8*o-i-1,c=(1<<l)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-s))<1&&(s--,a*=2),(e+=s+f>=1?h/a:h*Math.pow(2,1-f))*a>=2&&(s++,a/=2),s+f>=c?(u=0,s=c):s+f>=1?(u=(e*a-1)*Math.pow(2,i),s+=f):(u=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[r+d]=255&u,d+=p,u/=256,i-=8);for(s=s<<i|u,l+=i;l>0;t[r+d]=255&s,d+=p,s/=256,l-=8);t[r+d-p]|=128*g}var f={}.toString,h=Array.isArray||function(t){return"[object Array]"==f.call(t)};function d(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function p(t,e){if(d()<e)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=g.prototype:(null===t&&(t=new g(e)),t.length=e),t}function g(t,e,r){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return m(this,t)}return y(this,t,e,r)}function y(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);g.TYPED_ARRAY_SUPPORT?(t=e).__proto__=g.prototype:t=v(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!g.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|R(e,r);t=p(t,n);var i=t.write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(b(e)){var r=0|E(e.length);return 0===(t=p(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?p(t,0):v(t,e);if("Buffer"===e.type&&h(e.data))return v(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function w(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function m(t,e){if(w(e),t=p(t,e<0?0:0|E(e)),!g.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function v(t,e){var r=e.length<0?0:0|E(e.length);t=p(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function E(t){if(t>=d())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d().toString(16)+" bytes");return 0|t}function b(t){return!(null==t||!t._isBuffer)}function R(t,e){if(b(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return H(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return q(t).length;default:if(n)return H(t).length;e=(""+e).toLowerCase(),n=!0}}function A(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return D(this,e,r);case"utf8":case"utf-8":return B(this,e,r);case"ascii":return $(this,e,r);case"latin1":case"binary":return x(this,e,r);case"base64":return k(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function U(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function _(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=g.from(e,n)),b(e))return 0===e.length?-1:T(t,e,r,n,i);if("number"==typeof e)return e&=255,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):T(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function T(t,e,r,n,i){var o,s=1,u=t.length,a=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,u/=2,a/=2,r/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var c=-1;for(o=r;o<u;o++)if(l(t,o)===l(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===a)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(r+a>u&&(r=u-a),o=r;o>=0;o--){for(var f=!0,h=0;h<a;h++)if(l(t,o+h)!==l(e,h)){f=!1;break}if(f)return o}return-1}function I(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var u=parseInt(e.substr(2*s,2),16);if(isNaN(u))return s;t[r+s]=u}return s}function O(t,e,r,n){return X(H(e,t.length-r),t,r,n)}function S(t,e,r,n){return X(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function P(t,e,r,n){return S(t,e,r,n)}function N(t,e,r,n){return X(q(e),t,r,n)}function C(t,e,r,n){return X(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function k(t,e,r){return 0===e&&r===t.length?a(t):a(t.slice(e,r))}function B(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,u,a,l=t[i],c=null,f=l>239?4:l>223?3:l>191?2:1;if(i+f<=r)switch(f){case 1:l<128&&(c=l);break;case 2:128==(192&(o=t[i+1]))&&(a=(31&l)<<6|63&o)>127&&(c=a);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(a=(15&l)<<12|(63&o)<<6|63&s)>2047&&(a<55296||a>57343)&&(c=a);break;case 4:o=t[i+1],s=t[i+2],u=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&u)&&(a=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&u)>65535&&a<1114112&&(c=a)}null===c?(c=65533,f=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=f}return function(t){var e=t.length;if(e<=L)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=L));return r}(n)}g.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT,g.poolSize=8192,g._augment=function(t){return t.__proto__=g.prototype,t},g.from=function(t,e,r){return y(null,t,e,r)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array),g.alloc=function(t,e,r){return function(t,e,r,n){return w(e),e<=0?p(t,e):void 0!==r?"string"==typeof n?p(t,e).fill(r,n):p(t,e).fill(r):p(t,e)}(null,t,e,r)},g.allocUnsafe=function(t){return m(null,t)},g.allocUnsafeSlow=function(t){return m(null,t)},g.isBuffer=function(t){return null!=t&&(!!t._isBuffer||J(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&J(t.slice(0,0))}(t))},g.compare=function(t,e){if(!b(t)||!b(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},g.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(t,e){if(!h(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return g.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=g.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!b(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},g.byteLength=R,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)U(this,e,e+1);return this},g.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)U(this,e,e+3),U(this,e+1,e+2);return this},g.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)U(this,e,e+7),U(this,e+1,e+6),U(this,e+2,e+5),U(this,e+3,e+4);return this},g.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?B(this,0,t):A.apply(this,arguments)},g.prototype.equals=function(t){if(!b(t))throw new TypeError("Argument must be a Buffer");return this===t||0===g.compare(this,t)},g.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},g.prototype.compare=function(t,e,r,n,i){if(!b(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),u=Math.min(o,s),a=this.slice(n,i),l=t.slice(e,r),c=0;c<u;++c)if(a[c]!==l[c]){o=a[c],s=l[c];break}return o<s?-1:s<o?1:0},g.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},g.prototype.indexOf=function(t,e,r){return _(this,t,e,r,!0)},g.prototype.lastIndexOf=function(t,e,r){return _(this,t,e,r,!1)},g.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return I(this,t,e,r);case"utf8":case"utf-8":return O(this,t,e,r);case"ascii":return S(this,t,e,r);case"latin1":case"binary":return P(this,t,e,r);case"base64":return N(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var L=4096;function $(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function x(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function D(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=K(t[o]);return i}function z(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function Y(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function M(t,e,r,n,i,o){if(!b(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function j(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function G(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function Z(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(t,e,r,n,i){return i||Z(t,0,r,4),c(t,e,r,n,23,4),r+4}function W(t,e,r,n,i){return i||Z(t,0,r,8),c(t,e,r,n,52,8),r+8}g.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),g.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=g.prototype;else{var i=e-t;r=new g(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},g.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||Y(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},g.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||Y(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},g.prototype.readUInt8=function(t,e){return e||Y(t,1,this.length),this[t]},g.prototype.readUInt16LE=function(t,e){return e||Y(t,2,this.length),this[t]|this[t+1]<<8},g.prototype.readUInt16BE=function(t,e){return e||Y(t,2,this.length),this[t]<<8|this[t+1]},g.prototype.readUInt32LE=function(t,e){return e||Y(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},g.prototype.readUInt32BE=function(t,e){return e||Y(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},g.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||Y(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},g.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||Y(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},g.prototype.readInt8=function(t,e){return e||Y(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},g.prototype.readInt16LE=function(t,e){e||Y(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},g.prototype.readInt16BE=function(t,e){e||Y(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},g.prototype.readInt32LE=function(t,e){return e||Y(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},g.prototype.readInt32BE=function(t,e){return e||Y(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},g.prototype.readFloatLE=function(t,e){return e||Y(t,4,this.length),l(this,t,!0,23,4)},g.prototype.readFloatBE=function(t,e){return e||Y(t,4,this.length),l(this,t,!1,23,4)},g.prototype.readDoubleLE=function(t,e){return e||Y(t,8,this.length),l(this,t,!0,52,8)},g.prototype.readDoubleBE=function(t,e){return e||Y(t,8,this.length),l(this,t,!1,52,8)},g.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||M(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},g.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||M(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},g.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,1,255,0),g.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},g.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},g.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},g.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):G(this,t,e,!0),e+4},g.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):G(this,t,e,!1),e+4},g.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);M(this,t,e,r,i-1,-i)}var o=0,s=1,u=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===u&&0!==this[e+o-1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+r},g.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);M(this,t,e,r,i-1,-i)}var o=r-1,s=1,u=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===u&&0!==this[e+o+1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+r},g.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,1,127,-128),g.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},g.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},g.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},g.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):G(this,t,e,!0),e+4},g.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||M(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),g.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):G(this,t,e,!1),e+4},g.prototype.writeFloatLE=function(t,e,r){return F(this,t,e,!0,r)},g.prototype.writeFloatBE=function(t,e,r){return F(this,t,e,!1,r)},g.prototype.writeDoubleLE=function(t,e,r){return W(this,t,e,!0,r)},g.prototype.writeDoubleBE=function(t,e,r){return W(this,t,e,!1,r)},g.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!g.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},g.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!g.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=b(t)?t:H(new g(t,n).toString()),u=s.length;for(o=0;o<r-e;++o)this[o+e]=s[o%u]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function K(t){return t<16?"0"+t.toString(16):t.toString(16)}function H(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function q(t){return function(t){var e,r,u,a,l,c;o||s();var f=t.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");l="="===t[f-2]?2:"="===t[f-1]?1:0,c=new i(3*f/4-l),u=l>0?f-4:f;var h=0;for(e=0,r=0;e<u;e+=4,r+=3)a=n[t.charCodeAt(e)]<<18|n[t.charCodeAt(e+1)]<<12|n[t.charCodeAt(e+2)]<<6|n[t.charCodeAt(e+3)],c[h++]=a>>16&255,c[h++]=a>>8&255,c[h++]=255&a;return 2===l?(a=n[t.charCodeAt(e)]<<2|n[t.charCodeAt(e+1)]>>4,c[h++]=255&a):1===l&&(a=n[t.charCodeAt(e)]<<10|n[t.charCodeAt(e+1)]<<4|n[t.charCodeAt(e+2)]>>2,c[h++]=a>>8&255,c[h++]=255&a),c}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function X(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function J(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var Q=function(t,e){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},Q(t,e)};var tt="Invariant Violation",et=Object.setPrototypeOf,rt=void 0===et?function(t,e){return t.__proto__=e,t}:et,nt=function(t){function e(r){void 0===r&&(r=tt);var n=t.call(this,"number"==typeof r?tt+": "+r+" (see https://github.com/apollographql/invariant-packages)":r)||this;return n.framesToPop=1,n.name=tt,rt(n,e.prototype),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}Q(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error);function it(t,e){if(!t)throw new nt(e)}var ot=["log","warn","error","silent"],st=ot.indexOf("log");function ut(t){return function(){if(ot.indexOf(t)>=st)return console[t].apply(console,arguments)}}!function(t){t.log=ut("log"),t.warn=ut("warn"),t.error=ut("error")}(it||(it={}));var at,lt,ct=it;function ft(t,e=0){return t.reduce(((t,e)=>{const r=1&t;return t>>>=1,r&&(t=65535&(32768|t)),t+e&65535}),e)}!function(t){t.UTF_8="utf-8",t.ISO_8859_1="latin1"}(at||(at={})),function(t){t[t.CIRCLED=128]="CIRCLED",t[t.REVEALED=64]="REVEALED",t[t.INCORRECT=32]="INCORRECT",t[t.PREVIOUSLY_INCORRECT=16]="PREVIOUSLY_INCORRECT",t[t.UNKNOWN_08=8]="UNKNOWN_08",t[t.UNKNOWN_04=4]="UNKNOWN_04",t[t.UNKNOWN_02=2]="UNKNOWN_02",t[t.UNKNOWN_01=1]="UNKNOWN_01"}(lt||(lt={}));const ht=["circled","incorrect","previouslyIncorrect","revealed","unknown_08","unknown_04","unknown_02","unknown_01"],dt=g.from([]),pt=g.from([0]),gt=g.from("ICHEATED","ascii"),yt="ACROSS&DOWN\0",wt=/[.:]/,mt=/^([ 0-9]\d:[a-zA-Z0-9@#$%&+?]*?;)*$/,vt=/^(\d+),([01])$/,Et=/^(\d+)\.(\d+)([a-z])?$/,bt=/^[.:A-Za-z0-9@#$%&+?]+$/,Rt=/^[-.:A-Za-z0-9@#$%&+?]+$/,At="1.4";function Ut(t=At){ct(Et.test(t),"file version data did not match expected format");const[,e,r,n]=Et.exec(t);return[Number.parseInt(e),Number.parseInt(r),n]}function _t(t){return null!=t?t+"\0":""}function Tt(t=At){const[e]=Ut(t);return e>=2?at.UTF_8:at.ISO_8859_1}function It({title:t,author:e,copyright:r,clues:n,notepad:i,fileVersion:o}){const[s,u]=Ut(o);return _t(t)+_t(e)+_t(r)+n.join("")+(s>=1&&u>=3?_t(i):"")}function Ot(t){var e,r,n,i,o,s,u,a,l;const c=g.alloc(52);return c.write(yt,2,"ascii"),c.write(null!==(e=t.fileVersion)&&void 0!==e?e:At,24,"ascii"),c.writeUInt16LE(null!==(n=null===(r=null==t?void 0:t.misc)||void 0===r?void 0:r.unknown1)&&void 0!==n?n:0,28),c.writeUInt16LE(null!==(o=null===(i=null==t?void 0:t.misc)||void 0===i?void 0:i.scrambledChecksum)&&void 0!==o?o:0,30),g.from(null!==(u=null===(s=null==t?void 0:t.misc)||void 0===s?void 0:s.unknown2)&&void 0!==u?u:pt).copy(c,32),c.writeUInt8(t.width,44),c.writeUInt8(t.height,45),c.writeUInt16LE(t.clues.length,46),c.writeUInt16LE(null!==(l=null===(a=null==t?void 0:t.misc)||void 0===a?void 0:a.unknown3)&&void 0!==l?l:0,48),c.writeUInt16LE(t.isScrambled?4:0,50),c}function St(t,e){const r=g.alloc(8),n=ft(e);return r.write(t,0,"ascii"),r.writeUInt16LE(e.length,4),r.writeUInt16LE(n,6),g.concat([r,e,pt])}function Pt(t){const e=t.readString(4),r=t.readBytes(2).readUInt16LE(),n=t.readBytes(2).readUInt16LE(),i=t.readBytes(r),o=t.readBytes(1);return ct(ft(i)===n,`"${e}" section data does not match checksum"`),ct(pt.equals(o),`"${e}" section is missing terminating null byte`),{title:e,data:i}}function Nt({solution:t,width:e},r){return!wt.test(t[r])&&(r%e==0||wt.test(t[r-1]))&&!(r%e==e-1||wt.test(t[r+1]))}function Ct({solution:t,width:e},r){return!wt.test(t[r])&&(r<e||wt.test(t[r-e]))&&!(r>=t.length-e||wt.test(t[r+e]))}function kt(t){const e={};return 0!=(t&lt.CIRCLED)&&(e.circled=!0),0!=(t&lt.INCORRECT)&&(e.incorrect=!0),0!=(t&lt.PREVIOUSLY_INCORRECT)&&(e.previouslyIncorrect=!0),0!=(t&lt.REVEALED)&&(e.revealed=!0),0!=(t&lt.UNKNOWN_08)&&(e.unknown_08=!0),0!=(t&lt.UNKNOWN_04)&&(e.unknown_04=!0),0!=(t&lt.UNKNOWN_02)&&(e.unknown_02=!0),0!=(t&lt.UNKNOWN_01)&&(e.unknown_01=!0),e}function Bt(t){const{fileVersion:e,height:r,isScrambled:n,width:i,solution:o,state:s,clues:u,markupGrid:a,rebus:l}=t;ct(null!=r,'Puzzle is missing required field: "height"'),ct(null!=i,'Puzzle is missing required field: "width"'),ct(null!=o,'Puzzle is missing required field: "solution"'),ct(null!=u,'Puzzle is missing required field: "clues"'),null!=e&&ct(Et.test(e),"FileVersion must match the supported format: #.#[#]"),ct(o.length===i*r,`Puzzle width & height suggest solution should be ${i*r} characters long. Found ${o.length} characters instead.`),ct(bt.test(o),"Puzzle solution may only contain ., :, alphanumeric characters and the following symbols: @, #, $, %, &, +, ?"),null!=s&&(ct(s.length===i*r,`Puzzle width & height suggest state should be ${i*r} characters long. Found ${s.length} characters instead.`),ct([...s].every(((t,e)=>wt.test(t)===wt.test(o[e]))),"Black Squares in solution and state must match"),ct(Rt.test(s),"Puzzle state may only contain -, ., :, alphanumeric characters and the following symbols: @, #, $, %, &, +, ?"));let c=[...o].reduce(((t,e,r)=>(Nt({solution:o,width:i},r)&&(t+=1),Ct({solution:o,width:i},r)&&(t+=1),t)),0);if(ct(c===u.length,`Puzzle solution expects ${c} clues, but found ${u.length} clues`),null!=a&&(ct(a.length===o.length,`Markup grid should match puzzle solution in length. Expected length ${o.length}, but got ${a.length}`),ct(a.every((t=>null!=t&&Object.keys(t).every((t=>ht.includes(t))))),"Markup grid contains unsupported values")),null!=l){if(null!=l.grid){ct(l.grid.length===o.length,`Rebus grid should match puzzle solution in length.  Expected length ${o.length}, but got ${l.grid.length}`);new Set(l.grid.filter((t=>null!=t))).forEach((t=>{var e;ct("string"==typeof(null===(e=l.solution)||void 0===e?void 0:e[t]),`Rebus grid references key that is not found in solution: "${t}"`)}))}null!=l.state&&ct(l.state.length===o.length,`Rebus state should match puzzle solution in length.  Expected length ${o.length}, but got ${l.state.length}`)}}function Lt(t){const{fileVersion:e,solution:r}=t,n=zt(t),i=Tt(e),o=It(t),s=r+n,u=ft(Ot(t).subarray(44,52));return ft(g.from(s+o,i),u)}function $t(t){return ft(Ot(t).subarray(44,52))}function xt(t){const e=Tt(t.fileVersion),r=ft(Ot(t).subarray(44,52)),n=It(t),i=r,o=ft(g.from(t.solution,e)),s=ft(g.from(zt(t),e)),u=ft(g.from(n,e));return Uint8Array.from([255&i,255&o,255&s,255&u,i>>8,o>>8,s>>8,u>>8],((t,e)=>t^gt[e]))}function Dt(t){return t.solution.replace(/[^.:]/g,"-")}function zt(t){var e;return null!==(e=t.state)&&void 0!==e?e:Dt(t)}function Yt(t){var e;return null!=(null===(e=t.rebus)||void 0===e?void 0:e.solution)&&Object.keys(t.rebus.solution).length>0}function Mt(t){var e;return null!=(null===(e=t.rebus)||void 0===e?void 0:e.state)&&t.rebus.state.some((t=>null!=t))}class jt{constructor(t,e,r){this.buffer=t,this.encoding=e,this.cursor=null!=r?r:0}_getNextNullByte(){const t=this.buffer.indexOf(0,this.cursor);return-1===t?this.buffer.length-1:t}hasBytesToRead(){return this.cursor<this.buffer.length}readString(t){const e=this.cursor+t;if(t<=0)return;const r=this.buffer.toString(this.encoding,this.cursor,e);return this.cursor=e,r}readNullTerminatedString(){const t=this._getNextNullByte()-this.cursor,e=this.readString(t);return this.cursor+=1,e}readBytes(t){const e=this.cursor+t;if(t<=0)return;const r=this.buffer.subarray(this.cursor,e);return this.cursor=e,r}readNullTerminatedBytes(){const t=this._getNextNullByte()-this.cursor,e=this.readBytes(t);return this.cursor+=1,e}}function Gt(t){let e;if("0"===t)e=10;else if(/^[0-9]$/.test(t))e=Number.parseInt(t);else if(/^[@#$%&+?]$/.test(t))e={"@":11,"#":12,$:13,"%":14,"&":15,"+":16,"?":17}[t];else if(/^[A-Z]$/.test(t)){e=17+t.charCodeAt(0)-"A".charCodeAt(0)+1}else if(/^[a-z]$/.test(t)){e=43+t.charCodeAt(0)-"a".charCodeAt(0)+1}return it(null!=e,`encodeRebusKey: Encountered an invalid character "${t}"`),e-1}var Zt;!function(t){t.TITLE="TITLE",t.AUTHOR="AUTHOR",t.COPYRIGHT="COPYRIGHT",t.SIZE="SIZE",t.GRID="GRID",t.ACROSS="ACROSS",t.DOWN="DOWN",t.NOTEPAD="NOTEPAD",t.REBUS="REBUS"}(Zt||(Zt={}));const Ft=/^\s*\<ACROSS PUZZLE\>\s*$/,Wt=/^\s*\<ACROSS PUZZLE V2\>\s*$/,Vt=/^\s*\<(TITLE|AUTHOR|COPYRIGHT|SIZE|GRID|ACROSS|DOWN|NOTEPAD|REBUS)\>\s*$/,Kt=/^[A-Z.:]+/,Ht=/^[A-Za-z0-9@#$%&+?.:]+$/,qt=/^(\d+)x(\d+)$/,Xt=/\r\n|\n/,Jt=/[a-z]/,Qt=/^MARK;$/i,te=/^([A-Za-z0-9@#$%&+?]):([A-Z]+|\[\d+\]):([A-Za-z0-9@#$%&+?])$/;function ee(t,e){ct(1===e.length,`<${t}> section expects exactly one line. Found ${e.length} lines.`)}t.getBlankState=Dt,t.getFileChecksum=Lt,t.getFileEncoding=function(t){return Tt(t.fileVersion)},t.getHeaderChecksum=$t,t.getICheatedChecksum=xt,t.getState=zt,t.gridNumbering=function(t){const{solution:e}=t;let r=0;return[...e].map(((e,n)=>{if(Nt(t,n)||Ct(t,n))return r+=1,r}))},t.hasRebusSolution=Yt,t.hasRebusState=Mt,t.isCorrect=function(t,e=!1){var r;Bt(t),ct(!t.isScrambled,"Please unscramble the puzzle before checking correctness");let n=!1;if(!Yt(t)&&Mt(t))n=!1;else if(e||!Yt(t))n=!0;else{const e=null===(r=t.rebus)||void 0===r?void 0:r.state;n=null!=e&&e.every(((e,r)=>{const n=function(t,e){var r,n,i,o;const s=null===(n=null===(r=t.rebus)||void 0===r?void 0:r.grid)||void 0===n?void 0:n[e];if(s)return null===(o=null===(i=t.rebus)||void 0===i?void 0:i.solution)||void 0===o?void 0:o[s]}(t,r);return null!=n&&e===n}))}const i=t.state===t.solution;return n&&i},t.parseBinaryFile=function(t){let e=g.from(t);const r=e.indexOf(yt,0,"ascii");ct(r>=2,"File does not appear to be an AcrossLite PUZ file");const n=r-2;let i;n>0&&(i=e.subarray(0,n),e=e.subarray(n));const o=e.readUInt16LE(0),s=e.readUInt16LE(14),u=e.subarray(16,24),a=e.toString("ascii",24,28).replace(/\x00/g,""),l=e.readUInt16LE(28),c=e.readUInt16LE(30),f=e.subarray(32,44),h=e.readUInt8(44),d=e.readUInt8(45),p=e.readUInt16LE(46),y=e.readUInt16LE(48),w=e.readUInt16LE(50),m=Tt(a),v=new jt(e,m,52),E=h*d,b=v.readString(E),R=v.readString(E),A=v.readNullTerminatedString(),U=v.readNullTerminatedString(),_=v.readNullTerminatedString();let T=[];for(let t=0;t<p;t+=1){const t=v.readNullTerminatedString();ct(null!=t,"Failed to read clue from puzzle file"),T.push(t)}const I=v.readNullTerminatedString();let O,S,P;for(;v.hasBytesToRead();){const{title:t,data:e}=Pt(v);switch(t){case"GEXT":O=Array.from(e).map((t=>kt(t)));break;case"GRBS":{const t=Array.from(e).map((t=>t-1));t.forEach(((e,r)=>{e<0&&delete t[r]})),S=Object.assign(Object.assign({},null!=S?S:{}),{grid:t});break}case"RTBL":{const t=e.toString("ascii"),r=(N=t,ct(mt.test(N),"Rebus table text doesn't match expected format."),N.slice(0,-1).split(";").map((t=>t.split(":"))).reduce(((t,[e,r])=>Object.assign(Object.assign({},t),{[Number.parseInt(e)]:r})),{}));S=Object.assign(Object.assign({},null!=S?S:{}),{solution:r});break}case"RUSR":{let t=e.toString("ascii").slice(0,-1).split("\0");t.forEach(((e,r)=>{""===e&&delete t[r]})),S=Object.assign(Object.assign({},null!=S?S:{}),{state:t});break}case"LTIM":{const t=e.toString("ascii");ct(vt.test(t),"Timer data doesn't match expected format.");const[,r,n]=vt.exec(t);P={secondsElapsed:Number.parseInt(r),isPaused:"1"===n};break}default:console.warn("Unrecognized extension section:",t)}}var N;const C={author:U,copyright:_,fileVersion:a,height:d,isScrambled:Boolean(w),notepad:I,title:A,width:h,solution:b,state:R,clues:T,rebus:S,markupGrid:O,timer:P,misc:{unknown1:l,unknown2:f,unknown3:y,preamble:i,scrambledChecksum:c}};return ct($t(C)===s,"Header contents don't match checksum.  Please check that you are reading a valid PUZ file."),ct(Lt(C)===o,"File contents don't match checksum (1).  Please check that you are reading a valid PUZ file."),ct(u.equals(xt(C)),"File contents don't match checksum (2).  Please check that you are reading a valid PUZ file."),C},t.parseTextFile=function(t){var e;const r=t.split(Xt).filter((t=>""!==t)),n=Ft.test(r[0]),i=Wt.test(r[0]);ct(n||i,"File does not appear to be an Across Lite puzzle description");const o=n?0:1;[Zt.TITLE,Zt.AUTHOR,Zt.COPYRIGHT,Zt.SIZE,Zt.GRID,Zt.ACROSS,Zt.DOWN].forEach((t=>{const e=r.some((e=>new RegExp(`^\\s*\\<${t}\\>\\s*$`).test(e)));ct(e,`File is missing required tag: <${t}>`)}));const s={};let u,a;const l=r.slice(1);for(;l.length>0;){const t=l.shift();ct(Vt.test(t),`Couldn't parse file.  Expected section tag, but got: "${t}"`);const[,e]=Vt.exec(t),r=[];for(;l.length>0&&!Vt.test(l[0]);){const t=l.shift();r.push(t)}switch(e){case Zt.TITLE:ee(e,r),s.title=r[0].trim();break;case Zt.AUTHOR:ee(e,r),s.author=r[0].trim();break;case Zt.COPYRIGHT:ee(e,r),s.copyright=r[0].trim();break;case Zt.SIZE:{ee(e,r);const t=r[0].trim();ct(qt.test(t),`Puzzle size expected in the format "WIDTHxHEIGHT" (e.g. "15x15"). Received: "${t}"`);const[,n,i]=qt.exec(t);s.width=Number.parseInt(n),s.height=Number.parseInt(i);break}case Zt.GRID:{const t=r.map((t=>t.trim())),e=1===o?Ht:Kt;ct(t.every((t=>e.test(t))),"<GRID> section contains unsupported characters."),s.solution=t.join("");break}case Zt.ACROSS:u=r.map((t=>t.trim()));break;case Zt.DOWN:a=r.map((t=>t.trim()));break;case Zt.NOTEPAD:s.notepad=r.join("\n");break;case Zt.REBUS:{ct(0!==o,"The <REBUS> tag is not supported in V1 text files.  Consider using the <ACROSS PUZZLE V2> file tag");let t=s.solution;ct(null!=t,"The <REBUS> tag is expected to come after <GRID> in puzzle descriptions");const e=new Array(t.length),n={};r.map((t=>t.trim())).forEach((r=>{if(Qt.test(r)&&null==s.markupGrid){const e=[...t].map((t=>Jt.test(t)?{circled:!0}:{}));e.some((({circled:t})=>t))&&(s.markupGrid=e)}if(te.test(r)){const[,i,o,s]=te.exec(r),u=Gt(i);[...t].forEach(((t,r)=>{t===i&&(e[r]=u)})),n[u]=o,t=t.replaceAll(i,s)}})),Object.keys(n).length>0&&(s.solution=t,s.rebus={grid:e,solution:n});break}default:throw new Error(`Unhandled section tag: ${t}`)}}s.solution=null===(e=s.solution)||void 0===e?void 0:e.toUpperCase();const{width:c,solution:f}=s;return null!=c&&null!=f&&null!=u&&null!=a&&(s.clues=function({solution:t,width:e},r,n){const i=r.slice(),o=n.slice(),s=[];return[...t].forEach(((r,n)=>{Nt({solution:t,width:e},n)&&s.push(i.shift()),Ct({solution:t,width:e},n)&&s.push(o.shift())})),s}({width:c,solution:f},u,a)),Bt(s),s},t.printBinaryFile=function(t){var e,r,n,i,o,s;Bt(t);const u=Tt(t.fileVersion),a=t.solution+zt(t),l=`${null!==(e=t.title)&&void 0!==e?e:""}\0${null!==(r=t.author)&&void 0!==r?r:""}\0${null!==(n=t.copyright)&&void 0!==n?n:""}\0`,c=t.clues.join("\0")+"\0",f=`${null!==(i=t.notepad)&&void 0!==i?i:""}\0`,h=g.from(a+l+c+f,u),d=Ot(t),p=Lt(t),y=$t(t),w=xt(t);d.writeUInt16LE(p,0),d.writeUInt16LE(y,14),g.from(w).copy(d,16);let m=dt,v=dt,E=dt;if(t.rebus){if(t.rebus.grid){m=St("GRBS",Uint8Array.from(t.rebus.grid,(t=>null==t?0:t+1)))}if(t.rebus.solution){v=St("RTBL",g.from((b=t.rebus.solution,Object.entries(b).reduce(((t,[e,r])=>`${t}${e.padStart(2," ")}:${r};`),"")),"ascii"))}if(t.rebus.state){const e=t.rebus.state.map((t=>null==t?"":t)).join("\0")+"\0";E=St("RUSR",g.from(e,"ascii"))}}var b;let R=dt;if(null!=t.timer){R=St("LTIM",g.from(`${t.timer.secondsElapsed},${t.timer.isPaused?1:0}`,"ascii"))}let A=dt;if(null!=t.markupGrid){A=St("GEXT",Uint8Array.from(t.markupGrid,(t=>function({circled:t,incorrect:e,previouslyIncorrect:r,revealed:n,unknown_08:i,unknown_04:o,unknown_02:s,unknown_01:u}){return(t?lt.CIRCLED:0)+(e?lt.INCORRECT:0)+(r?lt.PREVIOUSLY_INCORRECT:0)+(n?lt.REVEALED:0)+(i?lt.UNKNOWN_08:0)+(o?lt.UNKNOWN_04:0)+(s?lt.UNKNOWN_02:0)+(u?lt.UNKNOWN_01:0)}(t))))}return g.concat([null!==(s=null===(o=null==t?void 0:t.misc)||void 0===o?void 0:o.preamble)&&void 0!==s?s:dt,d,h,m,v,R,A,E])},t.printTextFile=function(t,e="\t",r="Unix"){var n;Bt(t);const i="Windows"===r?"\r\n":"\n";function o(t){return`${e}${null!=t?t:""}${i}`}const{markupGrid:s,rebus:u}=t,a=null!=s||null!=u;let l=t.solution,c=[];if(null!=s&&(l=l.split("").map(((t,e)=>s[e].circled?t.toLowerCase():t)).join("")),null!=(null==u?void 0:u.grid)&&null!=(null==u?void 0:u.solution)){const{rebusGrid:t,rebusSolution:e}=function(t,e){const r=Object.keys(e).map((t=>Number.parseInt(t))).sort(((t,e)=>t-e)),n=function(t,e){const r=[];let n=t;for(;n<e;)r.push(n),n+=1;return r}(0,r.length);if(n.every(((t,e)=>t===r[e])))return{rebusGrid:t,rebusSolution:e};function i(t){return t&&n[r.indexOf(t)]}return{rebusGrid:t.map((t=>i(t))),rebusSolution:Object.fromEntries(Object.entries(e).map((([t,e])=>[i(Number.parseInt(t)),e])))}}(u.grid,u.solution);Object.entries(e).forEach((([e,r])=>{let n,i=[];const o=Number.parseInt(e);ct(!Number.isNaN(o),`Encoded rebus keys should be numeric. Found: ${e}`);const s=function(t){if(1<=(t+=1)&&t<=9)return t.toString();if(10===t)return"0";if(11<=t&&t<=17)return{11:"@",12:"#",13:"$",14:"%",15:"&",16:"+",17:"?"}[t];throw new nt(`encodeRebusKey: Encountered an unsupported rebus key "${t}"`)}(o);t.forEach(((t,e)=>{t===o&&(i.push(e),null==n&&(n=l[e]),ct(n===l[e],"Text format cannot encode multiple short solutions for a single rebus substitution"))})),ct(null!=n&&i.length>0,`Rebus solutions should have at least one corresponding grid entry. Key: ${e} Grid: ${t}`),l=l.split("").map(((t,e)=>i.includes(e)?s:t)).join(""),c.push(`${s}:${r}:${n}`)}))}let f="";f+="<ACROSS PUZZLE V2>"+i,f+="<TITLE>"+i,f+=o(t.title),f+="<AUTHOR>"+i,f+=o(t.author),f+="<COPYRIGHT>"+i,f+=o(t.copyright),f+="<SIZE>"+i,f+=o(`${t.width}x${t.height}`),f+="<GRID>"+i,l.match(new RegExp(`.{${t.width}}`,"g")).forEach((t=>{f+=o(t)})),a&&(f+="<REBUS>"+i,(null===(n=t.markupGrid)||void 0===n?void 0:n.some((({circled:t})=>t)))&&(f+=o("MARK;")),c.forEach((t=>{f+=o(t)})));const{across:h,down:d}=function(t){const{clues:e,solution:r}=t,n=e.slice(),i=[],o=[];return[...r].forEach(((e,r)=>{Nt(t,r)&&i.push(n.shift()),Ct(t,r)&&o.push(n.shift())})),{across:i,down:o}}(t);return f+="<ACROSS>"+i,h.forEach((t=>f+=o(t))),f+="<DOWN>"+i,d.forEach((t=>f+=o(t))),null!=t.notepad&&(f+="<NOTEPAD>"+i,f+=t.notepad+i),f},t.validate=Bt,Object.defineProperty(t,"__esModule",{value:!0})}));